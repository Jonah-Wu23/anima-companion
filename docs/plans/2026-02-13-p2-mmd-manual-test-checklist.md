# P2 MMD 集成手动测试清单

**测试目的**: 验证 MMD 模型加载、动作播放、口型同步等核心功能  
**测试环境**: http://localhost:3000  
**前置条件**: `npm run dev` 已启动

---

## 1. 基础加载测试

### 1.1 模型加载
- [x] 打开页面，观察模型加载进度指示器
- [x] 验证白厄模型在 5 秒内完成加载
- [x] 检查贴图是否完整（面部、头发、服装无缺失）
- [x] 打开 DevTools Network，确认所有贴图请求 200

**预期结果**: 模型正常显示，贴图完整，无 404 错误

### 1.2 降级测试
- [x] 修改 `DEFAULT_MODEL_PATH` 为不存在路径
- [x] 刷新页面，验证是否显示 SunnyBubble
- [x] 恢复正确路径，验证模型重新加载

**文件位置**: `web/src/components/Viewport3D.tsx`

---

## 2. 动作状态机测试

### 2.1 Idle 状态
- [x] 页面加载完成后，观察角色是否播放待机动画
- [x] 验证动画循环播放，无卡顿

**参考动作**: `ot0510_待機_素立ち_まばたき付き.vmd`

**2月13日完成至此处**

### 2.2 Listening 状态
- [ ] 点击录音按钮（或触发 recording stage）
- [ ] 验证角色切换到"两手后"姿势
- [ ] 观察动作过渡是否平滑

**参考动作**: `ot0510_待機_両手後ろ_まばたき付き.vmd`

### 2.3 Speaking 状态
- [ ] 发送消息触发对话
- [ ] 验证角色切换到说话动作
- [ ] 观察口型是否随语音变化

**参考动作**: `xs-talk1-east-謝.vmd`

### 2.4 Thinking 状态
- [ ] 观察处理中的思考动作
- [ ] 验证是否为"腕組み"或"猫背"姿势

**参考动作**: `腕組みIA.vmd` 或 `ot0510_待機_猫背_まばたき付き.vmd`

### 2.5 Error 状态
- [ ] 模拟错误（如断开网络）
- [ ] 验证角色是否播放土下座动作

**参考动作**: `受.vmd`

---

## 3. 口型同步测试

### 3.1 基础口型
- [ ] 播放语音时观察嘴部 Morph 变化
- [ ] 验证嘴型大小与语音能量匹配

**调试方法**: 在 Console 执行:
```javascript
// 模拟不同能量值
window.__testLipSync && window.__testLipSync(0.1); // 微张
window.__testLipSync && window.__testLipSync(0.5); // 半张
window.__testLipSync && window.__testLipSync(1.0); // 大张
```

### 3.2 Morph 名称验证
- [ ] 打开 DevTools Console
- [ ] 检查是否有 "Morph not found" 警告
- [ ] 如有警告，记录实际的 Morph 名称

**预期 Morph 名称**: `あ`, `い`, `う`, `え`, `お`

---

## 4. 性能测试

### 4.1 帧率监控
- [ ] 打开 DevTools Performance
- [ ] 录制 10 秒，观察 FPS
- [ ] 桌面目标: >= 60 FPS

### 4.2 内存监控
- [ ] 打开 DevTools Memory
- [ ] 观察 JS Heap 大小
- [ ] 目标: <= 200MB

### 4.3 加载时间
- [ ] 打开 DevTools Network
- [ ] 清空缓存刷新 (Ctrl+Shift+R)
- [ ] 记录 PMX 文件加载时间
- [ ] 目标: <= 5s (本地)

---

## 5. 边界情况测试

### 5.1 快速切换
- [ ] 快速点击录音/停止，观察动作切换
- [ ] 验证无卡顿或异常

### 5.2 长时间运行
- [ ] 保持页面运行 5 分钟
- [ ] 观察内存是否持续增长
- [ ] 验证动画仍正常播放

### 5.3 资源清理
- [ ] 切换页面后返回
- [ ] 验证无重复加载或内存泄漏

---

## 6. 问题记录模板

发现问题时请按以下格式记录:

```markdown
### 问题 [编号]: [简要描述]

**复现步骤**:
1. ...
2. ...

**预期结果**:
...

**实际结果**:
...

**环境信息**:
- 浏览器: [Chrome/Firefox/Edge]
- 分辨率: [1920x1080 等]
- 控制台错误: [粘贴错误信息]

**截图**:
[如有]
```

---

## 7. 验收标准速查

| 检查项 | 标准 | 结果 |
|-------|------|------|
| PMX加载 | 5秒内完成 | |
| 贴图完整 | 无缺失 | |
| 动作播放 | 5个状态正常 | |
| Crossfade | 过渡平滑 | |
| 口型同步 | 响应能量变化 | |
| 桌面帧率 | >= 60 FPS | |
| 降级机制 | 失败显示SunnyBubble | |

---

**测试完成日期**: ___________  
**测试人**: ___________  
**整体结果**: ⬜ 通过 / ⬜ 有条件通过 / ⬜ 未通过
