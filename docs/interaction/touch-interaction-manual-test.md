# 触摸互动手动测试说明（P3）

## 1. 目标与范围

本手册用于验证以下两项交付是否达到可用标准：

| 模块 | 验证目标 |
|---|---|
| 触摸互动的交互设计 | 点击 / 拖拽 / 悬停反馈规则与手势行为符合设计 |
| 触摸互动的判定与驱动 | Raycast 命中、命中区域优先级、动作与表情触发正确 |

不在本手册范围内：
- 语音链路（VAD / ASR / TTS）功能正确性
- 非触摸相关 UI 文案与动效

## 2. 测试环境建议

## 2.1 设备矩阵

| 平台 | 浏览器 | 必测 |
|---|---|---|
| Windows/macOS 桌面 | Chrome 最新版 | 是 |
| Windows/macOS 桌面 | Edge 最新版 | 建议 |
| iOS | Safari 最新版 | 是 |
| Android | Chrome 最新版 | 是 |

## 2.2 运行前置

1. 启动前后端服务，进入模型主界面（3D 角色可见）。
2. 确认模型已完成加载，不处于全局 loading 状态。
3. 桌面端准备鼠标；移动端准备真机触控（优先真机，不只用模拟器）。

## 3. 通过标准

通过判定分级：
- `P0`：核心功能，必须通过。
- `P1`：体验与边界，建议通过。

最终准入建议：
- 所有 `P0` 全部通过；
- `P1` 至少 80% 通过，且无高风险崩溃/卡死。

## 4. 手动用例

## 4.1 手势与反馈（交互设计）

### TC-TCH-001 单击头部反馈（P0）

- 前置：角色静止可交互。
- 步骤：
1. 单击角色头部区域 1 次。
- 预期：
1. 触发一次点击反馈（非双击、非长按）。
2. 角色出现偏开心倾向表情与轻微动作响应。
3. 没有报错、没有卡顿。

### TC-TCH-002 单击脸部反馈（P0）

- 步骤：
1. 单击脸部（靠近眼鼻口）1 次。
- 预期：
1. 触发偏害羞/尴尬风格反馈。
2. 反馈区域命中应更偏向 face/eyes，而不是 body。

### TC-TCH-003 单击身体反馈（P0）

- 步骤：
1. 单击躯干位置 1 次。
- 预期：
1. 触发更放松风格反馈。
2. 不应误判为 head/face。

### TC-TCH-004 双击判定（P0）

- 步骤：
1. 在同一区域（建议 head）快速双击（两次间隔小于约 500ms）。
- 预期：
1. 触发双击反馈（惊讶倾向更明显）。
2. 不应出现“两次单击 + 一次双击”的叠加误触发。

### TC-TCH-005 非双击退化为单击（P1）

- 步骤：
1. 同一区域点击两次，但间隔明显大于 500ms。
2. 同一区域快速两次点击，但第二次偏移较大（> 约 8% 视口宽高归一化距离）。
- 预期：
1. 均按单击处理，不应触发双击反馈。

### TC-TCH-006 长按判定（P0）

- 步骤：
1. 在 head 或 face 按住约 500ms 以上，不移动或仅极小移动。
2. 松手。
- 预期：
1. 触发长按反馈（偏 relaxed/happy）。
2. 长按触发后松手不应再额外触发一次单击。

### TC-TCH-007 拖拽起始阈值（P0）

- 步骤：
1. 按下后移动小于 10px，松手。
2. 按下后移动明显大于 10px，再持续拖动。
- 预期：
1. 小位移应维持点击链路，不进入 drag。
2. 超阈值后应进入 dragStart + dragMove 链路。

### TC-TCH-008 悬停反馈（桌面）（P0）

- 步骤：
1. 鼠标移动到 head/face 附近停留并缓慢移动。
2. 鼠标移出角色区域。
- 预期：
1. 进入 hover 后角色有头部跟随感。
2. 离开后 hover 清理，角色逐步恢复。

## 4.2 Raycast / 命中区域 / 触发驱动

### TC-HIT-001 命中区域优先级（P0）

- 说明：当前优先级为 `head(10) > face(9) > eyes(8) > hands(7) > shoulders(6) > body(5)`。
- 步骤：
1. 在 head/face/eyes 重叠视觉区域反复点击。
- 预期：
1. 优先命中高优先级区域（不应频繁掉到 body）。
2. 反馈风格与目标区一致。

### TC-HIT-002 世界坐标命中跟随动画（P0）

- 步骤：
1. 在角色播放动作或说话状态时，持续点击 head、leftHand、rightHand。
- 预期：
1. 命中区域随骨骼动画变化，点击仍能稳定命中对应部位。
2. 不出现“点头部却触发身体”的持续偏移。

### TC-HIT-003 拖拽驱动动作（P0）

- 步骤：
1. 从 head 区域开始拖拽。
2. 从 body 或 shoulders 区域开始拖拽。
3. 从 hand 区域尝试拖拽。
- 预期：
1. head 拖拽：头部跟随更明显。
2. body/shoulders 拖拽：身体位移响应明显。
3. hand 拖拽：不应进入拖拽驱动（手部拖拽已禁用）。
4. 若在 hand 区域发生大位移后松手，不应误触发点击。
5. 松手后逐步回归，不应卡在异常姿态。

### TC-HIT-004 空白区域与边界（P1）

- 步骤：
1. 点击角色外空白背景。
2. 指针移出 canvas 边界后再回到角色上。
- 预期：
1. 空白区域不触发角色触摸反馈。
2. 离开/返回不会造成 hover 或 drag 状态残留。

## 4.3 移动端专项

### TC-MOB-001 touchmove 节流与流畅度（P0）

- 步骤：
1. 手机上持续拖拽角色 10 秒以上。
- 预期：
1. 交互连续，无明显掉帧突刺。
2. 无明显输入堆积（手指停下后仍长时间继续运动）。

### TC-MOB-002 多点触控行为（P1）

- 步骤：
1. 第一根手指按住角色并拖动。
2. 第二根手指同时点按其他区域。
- 预期：
1. 仅首个有效 pointer 驱动交互，第二指被忽略或不影响当前手势。
2. 不报错、不崩溃、不出现卡死状态。

### TC-MOB-003 中断恢复（P1）

- 步骤：
1. 拖拽过程中触发系统中断（如通知栏下拉、来电打断、切后台再返回）。
- 预期：
1. 触发 cancel 后状态可恢复。
2. 不残留“持续拖拽中”或“持续悬停中”。

## 4.4 资源与清理（释放验证）

### TC-RES-001 事件监听清理（P0）

- 步骤：
1. 进入页面并完成一轮触摸测试。
2. 刷新页面或触发组件重挂载（开发模式下热更新也可）。
3. 再次执行同样触摸操作。
- 预期：
1. 反馈次数不应倍增。
2. 无明显重复触发（避免事件监听重复注册）。

### TC-RES-002 长时稳定性（P1）

- 步骤：
1. 连续测试点击/拖拽/悬停 5 分钟。
- 预期：
1. 无前台报错。
2. 模型不出现持续漂移、骨骼错乱或完全失去响应。

## 5. 结果记录模板

| 用例ID | 结果(Pass/Fail) | 设备/浏览器 | 证据（截图/录屏） | 备注 |
|---|---|---|---|---|
| TC-TCH-001 |  |  |  |  |
| TC-TCH-002 |  |  |  |  |
| TC-TCH-003 |  |  |  |  |
| TC-TCH-004 |  |  |  |  |
| TC-TCH-005 |  |  |  |  |
| TC-TCH-006 |  |  |  |  |
| TC-TCH-007 |  |  |  |  |
| TC-TCH-008 |  |  |  |  |
| TC-HIT-001 |  |  |  |  |
| TC-HIT-002 |  |  |  |  |
| TC-HIT-003 |  |  |  |  |
| TC-HIT-004 |  |  |  |  |
| TC-MOB-001 |  |  |  |  |
| TC-MOB-002 |  |  |  |  |
| TC-MOB-003 |  |  |  |  |
| TC-RES-001 |  |  |  |  |
| TC-RES-002 |  |  |  |  |

## 6. 失败定位指引（快速）

若出现问题，可优先检查：

- 手势阈值：`web/src/components/MMDCharacter.tsx`（`DRAG_THRESHOLD_PX`、`TOUCH_MOVE_THROTTLE_MS`、`LONG_PRESS_THRESHOLD_MS`）。
- 双击判定与冷却：`web/src/lib/interaction/TouchInteractionProvider.tsx`（双击窗口、点击提交延迟、zone cooldown）。
- 命中优先级与包围盒：`web/src/lib/interaction/RaycastManager.ts` 与 `web/src/components/MMDCharacter.tsx`（`createHitZoneConfigs`）。
- 表情映射与口型叠加：`web/src/lib/mmd/expression-driver.ts`。
- 动作驱动与 stage 协调：`web/src/lib/mmd/motion-driver.ts`。

## 7. 回归最小集（每次改动后必测）

每次修改触摸交互后，至少跑以下 7 条：

1. `TC-TCH-001` 单击头部。
2. `TC-TCH-004` 双击判定。
3. `TC-TCH-006` 长按判定。
4. `TC-TCH-007` 拖拽阈值切换。
5. `TC-HIT-001` 命中优先级。
6. `TC-HIT-003` 拖拽动作驱动。
7. `TC-RES-001` 监听清理验证。

## 8. 测试过程改动摘要（2026-02-15）

以下为本轮手动测试过程中，为通过用例而落地的实现修正：

1. 表情回落修正：触摸表情不再“只上不下”，避免点击后卡表情。
2. 拖拽方向修正：drag 的 Y 方向翻转为“向上为正”。
3. 桌面 hover 修正：无按下鼠标时也可触发 hover 跟随。
4. hover 参考系修正：从“全画布坐标”改为“命中区域中心相对坐标”。
5. hover 命中范围调整：head/face/eyes 命中盒适度扩大。
6. body/shoulders 拖拽增强：位移驱动增益提升，响应更可感知。
7. 手部拖拽禁用：leftHand/rightHand 不再参与 drag 判定与驱动，避免诡异动作。

## 9. 完成确认（2026-02-16）

本次触摸互动手动测试已完成，核心用例覆盖点击、双击、长按、拖拽、悬停、命中判定与资源清理。针对测试中发现的问题已完成代码修正并回归通过，当前版本可作为 P3 阶段触摸互动模块的验收基线；后续迭代请按第 7 节“回归最小集”执行复测。

---

文档版本：v1.2  
更新日期：2026-02-16  
作者：强逻辑AI（基于当前实现）
